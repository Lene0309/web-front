<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>编辑客户</title>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
</head>
<body>
<div id="app">
    <el-card class="box-card" style="width: 600px; margin: 50px auto;">
        <div slot="header">
            <span>编辑客户</span>
            <el-button style="float: right; padding: 3px 0" type="text" 
                       @click="goBack">返回</el-button>
        </div>
        <el-form :model="customerForm" :rules="rules" ref="customerForm" label-width="100px">
            <el-form-item label="用户ID">
                <el-input v-model="customerForm.customerId" :disabled="true"></el-input>
            </el-form-item>
            <el-form-item label="用户名" prop="username">
                <el-input v-model="customerForm.username"></el-input>
            </el-form-item>
            <el-form-item label="真实姓名" prop="realName">
                <el-input v-model="customerForm.realName"></el-input>
            </el-form-item>
            <el-form-item label="手机号" prop="phone">
                <el-input v-model="customerForm.phone"></el-input>
            </el-form-item>
            <el-form-item label="邮箱" prop="email">
                <el-input v-model="customerForm.email"></el-input>
            </el-form-item>
            <el-form-item>
                <el-button type="primary" @click="submitForm">保存</el-button>
                <el-button @click="goBack">取消</el-button>
            </el-form-item>
        </el-form>
    </el-card>
</div>

<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="../axios.min.js"></script>
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<script>
new Vue({
    el: '#app',
    data() {
        return {
            customerForm: {
                customerId: '',
                username: '',
                realName: '',
                phone: '',
                email: ''
            },
            rules: {
                username: [
                    { required: true, message: '请输入用户名', trigger: 'blur' },
                    { min: 3, max: 20, message: '长度在 3 到 20 个字符', trigger: 'blur' }
                ],
                realName: [
                    { required: true, message: '请输入真实姓名', trigger: 'blur' }
                ],
                phone: [
                    { pattern: /^1[3-9]\d{9}$/, message: '请输入正确的手机号', trigger: 'blur' }
                ],
                email: [
                    { type: 'email', message: '请输入正确的邮箱地址', trigger: 'blur' }
                ]
            }
        }
    },
    created() {
        const urlParams = new URLSearchParams(window.location.search);
        const customerId = urlParams.get('id');
        if (customerId) {
            this.loadCustomer(customerId);
        }
    },
    methods: {
        loadCustomer(customerId) {
            axios.get(`http://localhost:9000/customer/detail/${customerId}`)
                .then(res => {
                    if (res.data.code === 200) {
                        this.customerForm = res.data.data;
                    } else {
                        this.$message.error(res.data.message);
                        this.goBack();
                    }
                })
                .catch(error => {
                    this.$message.error('加载客户信息失败');
                    console.error(error);
                });
        },
        submitForm() {
            this.$refs.customerForm.validate(valid => {
                if (valid) {
                    axios.post('http://localhost:9000/customer/update', this.customerForm)
                        .then(res => {
                            if (res.data.code === 200) {
                                this.$message.success(res.data.message);
                                this.goBack();
                            } else {
                                this.$message.error(res.data.message);
                            }
                        })
                        .catch(error => {
                            this.$message.error('保存失败: ' + error.message);
                        });
                }
            });
        },
        goBack() {
            window.location.href = 'CustomerList.html';
        }
    }
});
</script>
</body>
</html>