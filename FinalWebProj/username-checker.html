<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”¨æˆ·åæ£€æŸ¥å·¥å…·</title>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <style>
        body {
            font-family: 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Arial', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .check-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e4e7ed;
            border-radius: 8px;
        }
        .check-title {
            font-size: 18px;
            font-weight: bold;
            color: #409EFF;
            margin-bottom: 15px;
        }
        .result-box {
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            font-weight: 500;
        }
        .result-success {
            background: #f0f9ff;
            color: #67C23A;
            border: 1px solid #b3d8ff;
        }
        .result-error {
            background: #fef0f0;
            color: #F56C6C;
            border: 1px solid #fbc4c4;
        }
        .result-warning {
            background: #fdf6ec;
            color: #E6A23C;
            border: 1px solid #f5dab1;
        }
        .existing-users {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e4e7ed;
            border-radius: 6px;
            padding: 10px;
            background: #fafafa;
        }
        .user-item {
            padding: 8px;
            border-bottom: 1px solid #e4e7ed;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .user-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div id="app" class="container">
        <h1 style="text-align: center; color: #409EFF; margin-bottom: 30px;">ç”¨æˆ·åæ£€æŸ¥å·¥å…·</h1>
        
        <div class="check-section">
            <div class="check-title">ğŸ” æ£€æŸ¥ç”¨æˆ·åå¯ç”¨æ€§</div>
            <el-form :model="checkForm" label-width="100px">
                <el-form-item label="ç”¨æˆ·å">
                    <el-input 
                        v-model="checkForm.username" 
                        placeholder="è¾“å…¥è¦æ£€æŸ¥çš„ç”¨æˆ·å"
                        @blur="checkUsername"
                        @keyup.enter.native="checkUsername">
                        <el-button slot="append" @click="checkUsername" :loading="checking">
                            æ£€æŸ¥
                        </el-button>
                    </el-input>
                </el-form-item>
            </el-form>
            
            <div v-if="checkResult" class="result-box" :class="resultClass">
                <div v-if="checkResult.available">
                    âœ… ç”¨æˆ·åå¯ç”¨
                </div>
                <div v-else>
                    âŒ ç”¨æˆ·åå·²å­˜åœ¨
                </div>
                <div style="margin-top: 10px; font-size: 14px;">
                    <div>ç”¨æˆ·å: {{ checkResult.username }}</div>
                    <div>æ£€æŸ¥æ—¶é—´: {{ checkResult.time }}</div>
                    <div v-if="checkResult.suggestion">å»ºè®®: {{ checkResult.suggestion }}</div>
                </div>
            </div>
        </div>
        
        <div class="check-section">
            <div class="check-title">ğŸ“‹ ç°æœ‰ç”¨æˆ·ååˆ—è¡¨</div>
            <el-button type="primary" @click="loadExistingUsers" :loading="loadingUsers">
                åˆ·æ–°ç”¨æˆ·åˆ—è¡¨
            </el-button>
            
            <div v-if="existingUsers.length > 0" class="existing-users" style="margin-top: 15px;">
                <div v-for="user in existingUsers" :key="user.customerId" class="user-item">
                    <div>
                        <strong>{{ user.username }}</strong>
                        <span style="color: #909399; margin-left: 10px;">ID: {{ user.customerId }}</span>
                    </div>
                    <div style="color: #909399; font-size: 12px;">
                        {{ user.realName || 'æœªè®¾ç½®å§“å' }}
                    </div>
                </div>
            </div>
            <div v-else-if="!loadingUsers" style="text-align: center; color: #909399; margin-top: 15px;">
                æš‚æ— ç”¨æˆ·æ•°æ®
            </div>
        </div>
        
        <div class="check-section">
            <div class="check-title">ğŸ”§ ç”¨æˆ·åç”Ÿæˆå»ºè®®</div>
            <el-form :model="suggestionForm" label-width="100px">
                <el-form-item label="åŸºç¡€åç§°">
                    <el-input 
                        v-model="suggestionForm.baseName" 
                        placeholder="è¾“å…¥åŸºç¡€åç§°ï¼Œå¦‚ï¼šå¼ ä¸‰"
                        @keyup.enter.native="generateSuggestions">
                    </el-input>
                </el-form-item>
                <el-form-item>
                    <el-button type="primary" @click="generateSuggestions">
                        ç”Ÿæˆå»ºè®®ç”¨æˆ·å
                    </el-button>
                </el-form-item>
            </el-form>
            
            <div v-if="suggestions.length > 0" style="margin-top: 15px;">
                <h4>å»ºè®®çš„ç”¨æˆ·å:</h4>
                <el-tag 
                    v-for="suggestion in suggestions" 
                    :key="suggestion"
                    style="margin: 5px; cursor: pointer;"
                    @click="useSuggestion(suggestion)">
                    {{ suggestion }}
                </el-tag>
            </div>
        </div>
        
        <div class="check-section">
            <div class="check-title">ğŸ“ æ“ä½œæŒ‰é’®</div>
            <el-button type="primary" @click="goToCustomerAdd">å»æ·»åŠ å®¢æˆ·</el-button>
            <el-button type="success" @click="goToCustomerList">å®¢æˆ·åˆ—è¡¨</el-button>
            <el-button type="warning" @click="clearData">æ¸…é™¤æ•°æ®</el-button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="../axios.min.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    
    <script>
        new Vue({
            el: '#app',
            data() {
                return {
                    checkForm: {
                        username: ''
                    },
                    checkResult: null,
                    checking: false,
                    existingUsers: [],
                    loadingUsers: false,
                    suggestionForm: {
                        baseName: ''
                    },
                    suggestions: []
                }
            },
            computed: {
                resultClass() {
                    if (!this.checkResult) return '';
                    return this.checkResult.available ? 'result-success' : 'result-error';
                }
            },
            methods: {
                checkUsername() {
                    if (!this.checkForm.username.trim()) {
                        this.$message.warning('è¯·è¾“å…¥ç”¨æˆ·å');
                        return;
                    }
                    
                    this.checking = true;
                    axios.get('http://localhost:9000/customer/checkUsername', {
                        params: { username: this.checkForm.username }
                    }).then(res => {
                        const exists = res.data.exists || false;
                        this.checkResult = {
                            username: this.checkForm.username,
                            available: !exists,
                            time: new Date().toLocaleString(),
                            suggestion: exists ? this.generateSuggestion(this.checkForm.username) : null
                        };
                    }).catch(error => {
                        console.error('æ£€æŸ¥ç”¨æˆ·åå¤±è´¥:', error);
                        this.$message.error('æ£€æŸ¥ç”¨æˆ·åå¤±è´¥: ' + (error.response?.data?.message || error.message));
                    }).finally(() => {
                        this.checking = false;
                    });
                },
                
                loadExistingUsers() {
                    this.loadingUsers = true;
                    axios.get('http://localhost:9000/customer/list', {
                        params: { pageNum: 1, pageSize: 100 }
                    }).then(res => {
                        if (res.data.code === 200 && res.data.data) {
                            this.existingUsers = res.data.data.list || [];
                        } else {
                            this.existingUsers = [];
                        }
                    }).catch(error => {
                        console.error('åŠ è½½ç”¨æˆ·åˆ—è¡¨å¤±è´¥:', error);
                        this.$message.error('åŠ è½½ç”¨æˆ·åˆ—è¡¨å¤±è´¥');
                        this.existingUsers = [];
                    }).finally(() => {
                        this.loadingUsers = false;
                    });
                },
                
                generateSuggestions() {
                    if (!this.suggestionForm.baseName.trim()) {
                        this.$message.warning('è¯·è¾“å…¥åŸºç¡€åç§°');
                        return;
                    }
                    
                    const baseName = this.suggestionForm.baseName.trim();
                    const suggestions = [];
                    
                    // ç”Ÿæˆä¸åŒçš„ç”¨æˆ·åå»ºè®®
                    suggestions.push(baseName + '1');
                    suggestions.push(baseName + '2');
                    suggestions.push(baseName + '2024');
                    suggestions.push(baseName + '_user');
                    suggestions.push(baseName + '001');
                    suggestions.push(baseName + Math.floor(Math.random() * 1000));
                    
                    this.suggestions = suggestions;
                },
                
                generateSuggestion(username) {
                    const suggestions = [
                        username + '1',
                        username + '2',
                        username + '_new',
                        username + '2024',
                        username + Math.floor(Math.random() * 1000)
                    ];
                    return 'å»ºè®®ä½¿ç”¨: ' + suggestions[0];
                },
                
                useSuggestion(suggestion) {
                    this.checkForm.username = suggestion;
                    this.checkUsername();
                },
                
                goToCustomerAdd() {
                    window.location.href = 'CustomerAdd.html';
                },
                
                goToCustomerList() {
                    window.location.href = 'CustomerList.html';
                },
                
                clearData() {
                    this.checkForm.username = '';
                    this.checkResult = null;
                    this.suggestions = [];
                    this.suggestionForm.baseName = '';
                    this.$message.success('æ•°æ®å·²æ¸…é™¤');
                }
            },
            mounted() {
                this.loadExistingUsers();
            }
        });
    </script>
</body>
</html> 